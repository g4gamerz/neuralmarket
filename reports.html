<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Reports - NeuralMarket</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f4f8; }
        .navbar-gradient { background: linear-gradient(90deg, #1e3a8a 0%, #2563eb 100%); }
        .report-card:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.08), 0 4px 6px rgba(0,0,0,0.05); }
        .sentiment-badge-positive { background-color: #22c55e; color: white; }
        .sentiment-badge-negative { background-color: #ef4444; color: white; }
        .sentiment-badge-neutral { background-color: #6b7280; color: white; }
        .sentiment-badge-na { background-color: #9ca3af; color: white; } 
    </style>
</head>
<body class="bg-gray-100">

    <nav class="navbar-gradient shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center">
                    <a href="index.html" class="flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                        </svg>
                    </a>
                    <div class="ml-3">
                       <a href="index.html" class="text-2xl font-bold text-white">NeuralMarket</a>
                    </div>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="index.html" class="text-gray-300 hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Home</a>
                        <a href="analysis.html" class="text-gray-300 hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Analysis Tool</a>
                        <a href="reports.html" class="text-gray-200 bg-blue-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium" aria-current="page">My Reports</a>
                        <a href="login.html" id="logoutButtonNav" class="text-gray-300 hover:bg-blue-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium inline-flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                            Logout
                        </a>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button type="button" id="mobileMenuButton" class="bg-blue-700 inline-flex items-center justify-center p-2 rounded-md text-gray-300 hover:text-white hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-blue-800 focus:ring-white" aria-controls="mobile-menu-reports" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <span id="mobileMenuIconContainer">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="block h-6 w-6"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                        </span>
                    </button>
                </div>
            </div>
        </div>
        <div class="md:hidden hidden" id="mobile-menu-reports">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="text-gray-300 hover:bg-blue-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Home</a>
                <a href="analysis.html" class="text-gray-300 hover:bg-blue-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Analysis Tool</a>
                <a href="reports.html" class="text-gray-200 bg-blue-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium" aria-current="page">My Reports</a>
                <a href="login.html" id="logoutButtonMobileNav" class="text-gray-300 hover:bg-blue-700 hover:text-white block px-3 py-2 rounded-md text-base font-medium inline-flex items-center">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="inline-block mr-1 h-4 w-4"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    Logout
                </a>
            </div>
        </div>
    </nav>
    
    <div class="max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8">
        <header class="mb-8 flex justify-between items-center">
            <h1 class="text-3xl font-bold leading-tight text-gray-900">My Saved Reports</h1>
            <button id="clearReportsButton" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-red-300">
                Clear All Reports
            </button>
        </header>

        <div id="reportsListContainer">
            </div>

        <div id="emptyReportsMessage" class="hidden text-center py-12">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-gray-400 mb-4">
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="12" y1="18" x2="12" y2="12"></line><line x1="9" y1="15" x2="15" y2="15"></line>
            </svg>
            <h2 class="text-xl font-medium text-gray-700">No Reports Found</h2>
            <p class="mt-2 text-gray-500">You haven't generated or saved any reports yet.</p>
            <a href="analysis.html" class="mt-6 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                Analyze a Stock
            </a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const menuIconSVG = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="block h-6 w-6"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>';
            const xIconSVG = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="block h-6 w-6"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>';
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobile-menu-reports');
            const mobileMenuIconContainer = document.getElementById('mobileMenuIconContainer');
            if (mobileMenuButton && mobileMenu && mobileMenuIconContainer) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                    mobileMenuIconContainer.innerHTML = mobileMenu.classList.contains('hidden') ? menuIconSVG : xIconSVG;
                    mobileMenuButton.setAttribute('aria-expanded', !mobileMenu.classList.contains('hidden'));
                });
            }

            const reportsListContainer = document.getElementById('reportsListContainer');
            const emptyReportsMessage = document.getElementById('emptyReportsMessage');
            const clearReportsButton = document.getElementById('clearReportsButton');

            function displayReports() {
                const reports = JSON.parse(localStorage.getItem('neuralMarketReports')) || [];
                reports.sort((a, b) => b.id - a.id); 

                if (reports && reports.length > 0) {
                    reportsListContainer.innerHTML = ''; 
                    emptyReportsMessage.classList.add('hidden');
                    reportsListContainer.classList.remove('hidden');
                    const reportGrid = document.createElement('div');
                    reportGrid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6';

                    reports.forEach(report => {
                        let sentimentBadgeClass = 'sentiment-badge-na';
                        if (report.overallSentiment === 'Positive') sentimentBadgeClass = 'sentiment-badge-positive';
                        else if (report.overallSentiment === 'Negative') sentimentBadgeClass = 'sentiment-badge-negative';
                        else if (report.overallSentiment === 'Neutral') sentimentBadgeClass = 'sentiment-badge-neutral';
                        
                        const fileName = `Report_${report.stockSymbol}_${report.reportDate.replace(/-/g, '')}.pdf`;

                        const reportCardHTML = `
                            <div class="bg-white shadow-lg rounded-lg p-5 report-card transition-all duration-300 flex flex-col justify-between">
                                <div>
                                    <div class="flex justify-between items-start mb-2">
                                        <h3 class="text-lg font-semibold text-blue-700">${report.stockSymbol} - <span class="text-gray-700 font-normal">${report.companyName}</span></h3>
                                        <span class="text-xs px-2 py-1 rounded-full ${sentimentBadgeClass}">${report.overallSentiment}</span>
                                    </div>
                                    <p class="text-sm text-gray-500 mb-1">Generated: ${report.reportDate}</p>
                                    <p class="text-xs text-gray-400 mb-4">ID: ${report.id}</p>
                                </div>
                                <div class="mt-auto">
                                    <button type="button" 
                                       class="download-pdf-btn w-full mt-3 inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"
                                       data-pdf-base64="${report.pdfBase64}" 
                                       data-filename="${fileName}">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                        Download PDF
                                    </button>
                                </div>
                            </div>
                        `;
                        reportGrid.innerHTML += reportCardHTML;
                    });
                    reportsListContainer.appendChild(reportGrid);
                } else {
                    reportsListContainer.innerHTML = ''; 
                    reportsListContainer.classList.add('hidden');
                    emptyReportsMessage.classList.remove('hidden');
                }
            }

            displayReports(); // Load reports on page load

            reportsListContainer.addEventListener('click', function(event) {
                const button = event.target.closest('.download-pdf-btn');
                if (button) {
                    const base64Data = button.dataset.pdfBase64;
                    const filename = button.dataset.filename;
                    try {
                        const byteCharacters = atob(base64Data); 
                        const byteNumbers = new Array(byteCharacters.length);
                        for (let i = 0; i < byteCharacters.length; i++) {
                            byteNumbers[i] = byteCharacters.charCodeAt(i);
                        }
                        const byteArray = new Uint8Array(byteNumbers);
                        const blob = new Blob([byteArray], { type: 'application/pdf' });
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(blob);
                        link.download = filename;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(link.href); 
                    } catch (e) {
                        console.error("Error creating or downloading PDF:", e);
                        showModal(`Failed to prepare PDF for download: ${e.message}.`);
                    }
                }
            });

            clearReportsButton.addEventListener('click', function() {
                if (confirm("Are you sure you want to clear all saved reports? This action cannot be undone.")) {
                    localStorage.removeItem('neuralMarketReports');
                    displayReports(); 
                    showModal("All reports have been cleared.");
                }
            });

            const logoutHandlerReports = (event) => {
                event.preventDefault();
                showModal('Logout. Redirecting...');
                setTimeout(() => { window.location.href = 'login.html'; }, 1500);
            };
            const logoutButtonNav = document.getElementById('logoutButtonNav');
            const logoutButtonMobileNav = document.getElementById('logoutButtonMobileNav');
            if(logoutButtonNav) logoutButtonNav.addEventListener('click', logoutHandlerReports);
            if(logoutButtonMobileNav) logoutButtonMobileNav.addEventListener('click', logoutHandlerReports);
        });

        function showModal(message) { 
            const existingModal = document.getElementById('customModal');
            if (existingModal) existingModal.remove();
            const modalOverlay = document.createElement('div');
            modalOverlay.id = 'customModal';
            modalOverlay.className = 'fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50 p-4';
            const modalContent = document.createElement('div');
            modalContent.className = 'p-5 border w-full max-w-md shadow-lg rounded-md bg-white';
            const modalText = document.createElement('div');
            modalText.className = 'mt-3 text-center';
            const messageParagraph = document.createElement('p');
            messageParagraph.className = 'text-sm text-gray-700';
            messageParagraph.textContent = message;
            modalText.appendChild(messageParagraph);
            modalContent.appendChild(modalText);
            const actionsDiv = document.createElement('div');
            actionsDiv.className = 'mt-4 px-4 py-3 text-center';
            const closeButton = document.createElement('button');
            closeButton.id = 'closeModalButton';
            closeButton.className = 'px-4 py-2 bg-blue-600 text-white text-base font-medium rounded-lg shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50';
            closeButton.textContent = 'OK';
            actionsDiv.appendChild(closeButton);
            modalContent.appendChild(actionsDiv);
            modalOverlay.appendChild(modalContent);
            document.body.appendChild(modalOverlay);
            closeButton.addEventListener('click', () => modalOverlay.remove());
            modalOverlay.addEventListener('click', (event) => { if (event.target === modalOverlay) modalOverlay.remove(); });
        }
    </script>
</body>
</html>
